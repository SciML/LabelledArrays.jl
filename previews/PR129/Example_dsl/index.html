<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Example: Nice DiffEq Syntax Without A DSL · LabelledArrays.jl</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-90474609-3"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-90474609-3', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://labelledarrays.sciml.ai/stable/Example_dsl/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">LabelledArrays.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Example: Nice DiffEq Syntax Without A DSL</a></li><li><a class="tocitem" href="../SLArrays/">SLArrays</a></li><li><a class="tocitem" href="../LArrays/">LArrays</a></li><li><a class="tocitem" href="../NamedTuples_relation/">Relation to NamedTuples</a></li><li><a class="tocitem" href="../Note_labelled_slices/">Note: Labelled slices</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Example: Nice DiffEq Syntax Without A DSL</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Example: Nice DiffEq Syntax Without A DSL</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SciML/LabelledArrays.jl/blob/master/docs/src/Example_dsl.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Example:-Nice-DiffEq-Syntax-Without-A-DSL"><a class="docs-heading-anchor" href="#Example:-Nice-DiffEq-Syntax-Without-A-DSL">Example: Nice DiffEq Syntax Without A DSL</a><a id="Example:-Nice-DiffEq-Syntax-Without-A-DSL-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-Nice-DiffEq-Syntax-Without-A-DSL" title="Permalink"></a></h1><p>Users of the SciML ecosystem are often solving large models with complicated states and/or hundreds or thousands of parameters. These models are implemented using arrays, and those arrays have traditionally been indexed by integers,  such as <code>p[1]</code> or <code>p[1:5]</code>. Numerical indexing is wonderful for small  models, but can quickly cause problems as models become bigger. It is easy to  forget which index corresponds to which reaction rate or which diffusion coeffient.  This confusion can lead to difficult to debug problems in a user&#39;s code. <code>LabelledArrays</code>  can make an important difference here. It is much easier to build a model using parameter  references such as <code>p.rate_nacl</code> or <code>p.probability_birth</code>, instead  of <code>p[26]</code> or <code>p[1026]</code>. Labelled arrays make both the development and debugging of models  much faster.  </p><p>LabelledArrays.jl are a way to get DSL-like syntax without a macro. In this case, we can solve differential equations with labelled components by making use of labelled arrays, and always refer to the components by name instead of index.</p><p>One key caveat is that users do not need to sacrifice performance when using  labelled arrays. Labelled arrays are as performant as traditional numerically  indexed arrays.</p><p>Let&#39;s solve the Lorenz equation using an <code>LVector</code>s. <code>LVectors</code> are  mutable, hence we can use the non-allocating form of the <code>OrdinaryDiffEq</code>  API.</p><pre><code class="language-julia hljs">using LabelledArrays, OrdinaryDiffEq

function lorenz_f!(du,u,p,t)
  du.x = p.σ*(u.y-u.x)
  du.y = u.x*(p.ρ-u.z) - u.y
  du.z = u.x*u.y - p.β*u.z
end

u0 = @LArray [1.0,0.0,0.0] (:x,:y,:z)
p = @LArray [10.0, 28.0, 8/3]  (:σ,:ρ,:β)
tspan = (0.0,10.0)
prob = ODEProblem(lorenz_f!,u0,tspan,p)
sol = solve(prob,Tsit5())
# Now the solution can be indexed as .x/y/z as well!
sol[10].x</code></pre><p>In the example above, we used an <code>LArray</code> to define the intial state <code>u0</code> as well as the parameter vector <code>p</code>. The reminder of the ODE solution steps are are no different that the original <code>DifferentialEquations</code> <a href="https://diffeq.sciml.ai/stable/tutorials/ode_example/#Example-2:-Solving-Systems-of-Equations">tutorials</a>.</p><p>Alternatively, we can use an immutable <code>SLVector</code> to  implement the same equation. In this case, we need to  use the allocating form of the <code>OrdinaryDiffEq</code> API when defining our model equation.</p><pre><code class="language-julia hljs">LorenzVector = @SLVector (:x,:y,:z)
LorenzParameterVector = @SLVector (:σ,:ρ,:β)

function f(u,p,t)
  x = p.σ*(u.y-u.x)
  y = u.x*(p.ρ-u.z) - u.y
  z = u.x*u.y - p.β*u.z
  LorenzVector(x,y,z)
end

u0 = LorenzVector(1.0,0.0,0.0)
p = LorenzParameterVector(10.0,28.0,8/3)
tspan = (0.0,10.0)
prob = ODEProblem(f,u0,tspan,p)
sol = solve(prob,Tsit5())</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../SLArrays/">SLArrays »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Sunday 16 October 2022 22:32">Sunday 16 October 2022</span>. Using Julia version 1.8.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
